{"version":3,"sources":["app.raw.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["((document, mapboxgl) => {\n  if (!mapboxgl.supported()) {\n    alert(\"Hi sorry, looks like your browser is not supported to render the map 😢.\\n\\nYou could try to load this site on another (latest) browser perhaps? 🙏\");\n    return;\n  }\n\n  mapboxgl.accessToken = 'pk.eyJ1IjoiY2hlZWF1biIsImEiOiJjaXhmb3o3bTEwMDAzMnRudTJuNjh1eXQ1In0.yO6WeKJwx6yIPoVx5aPavQ';\n\n  const map = new mapboxgl.Map({\n    container: 'map',\n    style: 'mapbox://styles/cheeaun/cixol8ezg002g2rqs007w3jmt',\n    maxZoom: 14,\n    logoPosition: 'top-right',\n    attributionControl: false,\n    pitchWithRotate: false,\n    dragRotate: false,\n    boxZoom: false,\n    zoom: 0.1,\n  });\n  map.touchZoomRotate.disableRotation();\n\n  const $info = document.getElementById('info');\n  const $infoCountries = document.getElementById('info-countries');\n  const $infoPlaces = document.getElementById('info-places');\n  const $infoCheckins = document.getElementById('info-checkins');\n  const $countries = document.getElementById('countries');\n\n  const bodyClass = document.body.classList;\n  function startInteractive(){\n    bodyClass.add('interactive');\n  }\n  map.on('dragstart', startInteractive);\n  map.on('zoomstart', startInteractive);\n\n  function endInteractive(){\n    bodyClass.remove('interactive');\n  }\n  $countries.addEventListener('touchstart', endInteractive, false);\n  $countries.addEventListener('mouseenter', endInteractive);\n\n  function toggleInteractive(){\n    bodyClass.toggle('interactive');\n  }\n  map.on('click', toggleInteractive);\n\n  const numberWithCommas = x => x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n  map.addControl(new mapboxgl.AttributionControl({ compact: true }), 'top-right');\n  map.addControl(new mapboxgl.NavigationControl(), 'top-right');\n\n  function renderNumber(el, number) {\n    const frames = 60;\n    const inc = Math.ceil(number / frames);\n    let num = 0;\n    function render() {\n      if (num >= number) return;\n      num = num + inc;\n      if (num > number) num = number;\n      el.textContent = numberWithCommas(num);\n      requestAnimationFrame(render);\n    }\n    requestAnimationFrame(render);\n  };\n\n  Promise.all([\n    new Promise((resolve, reject) => {\n      map.on('load', resolve);\n      map.on('error', reject);\n    }),\n    fetch('data/checkins.min.geojson').then((data) => data.json()),\n  ]).then(([_, data]) => {\n    const _countries = {};\n    const _places = {};\n\n    const checkinsCount = data.features.length;\n\n    data.features = data.features.filter((f) => {\n      const { id, country } = f.properties;\n      const isUnique = !_places[id];\n      if (isUnique) {\n        if (!_countries[country]) {\n          const cc = f.properties.cc.toLowerCase();\n          _countries[country] = {\n            cc: cc,\n            bounds: new mapboxgl.LngLatBounds(),\n            places_count: 0,\n            checkins_count: 0,\n          };\n        }\n        const coordinates = f.geometry.coordinates;\n        _countries[country].bounds.extend([coordinates[0], coordinates[1]]);\n        _countries[country].places_count++;\n        _places[id] = true;\n      }\n      _countries[country].checkins_count++;\n      return isUnique;\n    });\n\n    const placesCount = Object.keys(_places).length;\n\n    const countries = Object.keys(_countries).map((country) => {\n      const c = _countries[country];\n      return {\n        name: country,\n        cc: c.cc,\n        bounds: c.bounds,\n        places_count: c.places_count,\n        checkins_count: c.checkins_count,\n      };\n    });\n\n    const countriesCount = countries.length;\n\n    countries.sort((a, b) => b.checkins_count - a.checkins_count);\n    countries.forEach((country, i) => {\n      const { cc, name, bounds, checkins_count, places_count } = country;\n      const $button = document.createElement('button');\n      $button.type = 'button';\n      $button.addEventListener('click', (e) => {\n        map.fitBounds(bounds, { padding: 150 });\n      }, false);\n      $button.innerHTML = `\n        <img src=\"data/countries/${cc}.svg\" width=\"50\" height=\"50\" alt=\"\"><br>\n        <b>${name}</b>\n        <br>\n        ${numberWithCommas(checkins_count)} check-in${checkins_count > 1 ? 's' : ''}\n        <br>\n        ${numberWithCommas(places_count)} place${places_count > 1 ? 's' : ''}\n      `;\n      $countries.appendChild($button);\n    });\n\n    map.addSource('checkins', {\n      type: 'geojson',\n      data: data,\n      cluster: true,\n      clusterMaxZoom: 10,\n      clusterRadius: 10,\n    });\n\n    map.addLayer({\n      id: 'cluster',\n      type: 'circle',\n      source: 'checkins',\n      filter: ['has', 'point_count'],\n      paint: {\n        'circle-radius': {\n          property: 'point_count',\n          stops: [\n            [{zoom: 0, value: 3}, 7],\n            [{zoom: 0, value: 10}, 10],\n            [{zoom: 0, value: 100}, 13],\n            [{zoom: 0, value: 200}, 16],\n          ],\n        },\n        'circle-color': '#14B7F4',\n        'circle-opacity': .9,\n        'circle-stroke-width': {\n          property: 'point_count',\n          stops: [\n            [3, 3],\n            [50, 6],\n          ],\n        },\n        'circle-stroke-color': '#14B7F4',\n        'circle-stroke-opacity': .3,\n      }\n    });\n\n    map.addLayer({\n      id: 'checkins-count',\n      type: 'symbol',\n      source: 'checkins',\n      filter: ['has', 'point_count'],\n      maxzoom: 11,\n      layout: {\n        'text-field': '{point_count_abbreviated}',\n        'text-size': 10,\n      },\n    });\n\n    map.addLayer({\n      id: 'checkins',\n      type: 'circle',\n      source: 'checkins',\n      minzoom: 8,\n      filter: ['!has', 'point_count'],\n      paint: {\n        'circle-radius': 3,\n        'circle-color': '#14B7F4',\n        'circle-opacity': .9,\n        'circle-stroke-width': 3,\n        'circle-stroke-color': '#14B7F4',\n        'circle-stroke-opacity': .1,\n      },\n    });\n\n    map.once('data', () => {\n      requestAnimationFrame(() => {\n        renderNumber($infoCheckins, checkinsCount);\n        renderNumber($infoPlaces, placesCount);\n        renderNumber($infoCountries, countriesCount);\n        bodyClass.add('render');\n      });\n    });\n\n    map.on('mouseenter', 'cluster', () => {\n      map.getCanvas().style.cursor = 'pointer';\n    });\n\n    map.on('click', 'cluster', (e) => {\n      map.flyTo({\n        center: e.lngLat,\n        zoom: map.getZoom() + 2,\n      });\n    });\n\n    map.on('mouseleave', 'cluster', () => {\n      map.getCanvas().style.cursor = '';\n    });\n\n    const filterByDate = (startDate, endDate) => {\n      map.setFilter('checkins', [\n        'all',\n        ['>=', 'date', startDate],\n        ['<=', 'date', endDate],\n        map.getFilter('checkins'),\n      ]);\n    };\n    // TODO: filter by date\n    // filterByDate(20160101, 20161212);\n  });\n})(document, mapboxgl);\n"]}